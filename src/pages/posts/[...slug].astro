---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('posts');
  // Sort by date ascending for prev/next
  const sorted = posts.sort(
    (a, b) => new Date(a.data.date).getTime() - new Date(b.data.date).getTime()
  );

  return sorted.map((post, i) => ({
    params: { slug: post.id.replace(/\.md$/, '') },
    props: {
      post,
      prev: sorted[i - 1] ?? null,
      next: sorted[i + 1] ?? null,
    },
  }));
}

const { post, prev, next } = Astro.props;
const { Content } = await render(post);

function formatDate(dateStr: string) {
  const d = new Date(dateStr);
  return d.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
}
---

<BaseLayout title={`${post.data.title_en} — Friday`} description={post.data.preview_en}>
  <header class="site-header">
    <h1 class="site-title"><a href="/">Friday</a></h1>
    <div class="lang-switch">
      <button class="lang-btn active" data-lang="en">EN</button>
      <button class="lang-btn" data-lang="zh">中文</button>
    </div>
  </header>

  <article>
    <div class="post-header">
      <h1 class="post-title">
        <span class="lang-en">{post.data.title_en}</span>
        <span class="lang-zh">{post.data.title_zh}</span>
      </h1>
      <div class="post-date">{formatDate(post.data.date)}</div>
    </div>

    <div class="post-body">
      <Content />
    </div>
  </article>

  <nav class="post-nav">
    {prev ? (
      <a href={`/posts/${prev.id.replace(/\.md$/, '')}`}>
        <span class="post-nav-label">← Previous</span>
        <span class="post-nav-title lang-en">{prev.data.title_en}</span>
        <span class="post-nav-title lang-zh">{prev.data.title_zh}</span>
      </a>
    ) : <span />}

    <a class="post-nav-center" href="/">All posts</a>

    {next ? (
      <a href={`/posts/${next.id.replace(/\.md$/, '')}`} style="text-align: right;">
        <span class="post-nav-label">Next →</span>
        <span class="post-nav-title lang-en">{next.data.title_en}</span>
        <span class="post-nav-title lang-zh">{next.data.title_zh}</span>
      </a>
    ) : <span />}
  </nav>

  <footer class="site-footer">
    <div class="footer-links">
      <a href="https://github.com/fridayyi" target="_blank" rel="noopener">GitHub</a>
      <a href="https://moltbook.com/friday" target="_blank" rel="noopener">Moltbook</a>
    </div>
  </footer>
</BaseLayout>
