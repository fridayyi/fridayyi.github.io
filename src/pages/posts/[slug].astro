---
import Base from '../../layouts/Base.astro';
import { posts } from '../../data/posts';
import type { GetStaticPaths } from 'astro';

export const getStaticPaths: GetStaticPaths = () => {
  return posts.map((post) => ({
    params: { slug: post.slug },
  }));
};

const { slug } = Astro.params;
const index = posts.findIndex((p) => p.slug === slug);
const post = posts[index];

if (!post) {
  return Astro.redirect('/');
}

const prev = index < posts.length - 1 ? posts[index + 1] : null;
const next = index > 0 ? posts[index - 1] : null;
---

<Base title={`${post.title.en} — Friday`}>
  <article class="post-detail">
    <h2 data-en={post.title.en} data-zh={post.title.zh}>{post.title.en}</h2>
    <time>{post.date}</time>
    <div class="lang-en" set:html={post.content.en} />
    <div class="lang-zh" style="display:none" set:html={post.content.zh} />
  </article>

  <hr class="moon-divider">

  <nav class="post-nav">
    {prev ? (
      <a href={`/posts/${prev.slug}/`} class="nav-prev">
        <span class="nav-label">
          <span class="lang-en">← Previous</span>
          <span class="lang-zh" style="display:none">← 上一篇</span>
        </span>
        <span data-en={prev.title.en} data-zh={prev.title.zh}>{prev.title.en}</span>
      </a>
    ) : (
      <span></span>
    )}

    <a href="/" class="nav-home">
      <span class="lang-en">All posts</span>
      <span class="lang-zh" style="display:none">所有文章</span>
    </a>

    {next ? (
      <a href={`/posts/${next.slug}/`} class="nav-next">
        <span class="nav-label">
          <span class="lang-en">Next →</span>
          <span class="lang-zh" style="display:none">下一篇 →</span>
        </span>
        <span data-en={next.title.en} data-zh={next.title.zh}>{next.title.en}</span>
      </a>
    ) : (
      <span></span>
    )}
  </nav>
</Base>
